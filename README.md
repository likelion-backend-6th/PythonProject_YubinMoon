## 1. 미션 요구사항 분석 & 체크리스트

---

### 1-1. 미션 요구사항 분석

---

**CLI 기반 메뉴**

메 루프마다 유저에게 보여줄 화면을 띄우고 필요하다면 유저의 입력을 받아야 한다.
메 메뉴마다 화면을 초기화 시켜줘야 한다.

**데이터 입력 기능**

직접입력과 파일선택의 2가지 입력 방법을 선택하게 한다.
입력은 사용자에게 필요한 입력을 받고 확인 후 적용한다.
파일은 자동 검색과 수동 입력을 넣고 자동의 경우 하위 디렉토리까지 검색한다.

**도서 정보 조회 기능**

사용자로부터 도서의 정보를 입력받아 상세를 출력한다.

**도서 대출 기능**

대출도서 확인과 대출 하기 선택
대출 시 도서 상태 변경

**도서 반납 기능**

대출도서 확인과 반납 하기 선택
반납 시 도서 상태 변경

**대출 정보 조회 기능**

대출 정보 출력

**종료 기능**

종료

---

### 1-2. 미션 체크리스트

---

**CLI 구현**
  
- 렌더 데이터 클래스
  
  화면에 출력할 데이터를 담을 클래스  
  페이지 목록과 상세 내용을 저장한다.  
  페이지는 문자열로 저장한다.

  - [x] 테스트 케이스 생성
  - [x] 페이지 리스트
  - [x] 선택된 페이지
  - [x] 상세 화면 데이터
  - [x] 데이터 업데이터

---

- 출력 함수

  데이터를 가지고 화면에 출력해 줄 클래스

  - [x] 테스트 케이스 생성
  - [x] 데이터를 가지고 화면 그리기
  - [x] 메번 출력

---

- 메인 컨트롤러 클래스

  루프를 돌면서 데이터를 받아 전달하고 다른 페이지를 생성해 실행하는 함수  
  겸사 겸사 키 입력을 받아 페이지에 전달

  - [x] 테스트 케이스 생성
  - [x] 출력 함수 실행
  - [x] 새 페이지 생성
  - [x] 키 입력 구현
  - [x] 뒤로가기 구현

---

**페이지 구현**

- Base Page

  페이지는 입력을 받아 로직을 실행한다.  
  페이지는 렌더 데이터 클래스를 반환할 수 있다.     
  페이지는 메인 컨트롤러에서 생성되고 실행된다.  

  - [x] 테스트 케이스 생성
  - [x] 렌더 데이터 반환
  - [x] 메인 로직 실행

- Main Page

  가장 처음에 출력되는 페이지 이다.

  - [x] 테스트 케이스 생성
  - [x] 종료 구현

- New Books Page

  새로운 책을 등록할 수 있는 페이지 이다.  
  입력 방법은 직접 입력과 파일 선택이 있다.  

  - [x] 테스트 케이스 생성
  - [x] 화면 출력 작성

- New Books with User Input

  유저 입력으로 새로운 도서를 등록함
  detail window에서 유저 입력
  정보: ID, 제목, 저자, 출판사

  - [x] 테스트 케이스 생성
  - [x] 입력 로직 구현
  - [x] 출력 생성 로직 구현

- New Books with User Input Check

  유저 입력이 올바른지 확인

  - [x] 테스트 케이스 생성
  - [x] Y/N 선택 로직 구현
  - [x] 출력 생성 로직 구현

- New Books with User Input Done

  유저 입력으로 책 생성

  - [x] 테스트 케이스 생성
  - [x] 책 생성 로직 구현

- New Books with File Input

  파일로 새로운 도서를 등록함
  파일 경로 입력
  정보: ID, 제목, 저자, 출판사

  - [x] 테스트 케이스 생성
  - [x] 경로 입력 구현

- New Books with File Input Check

  파일을 읽어 데이터베이스에 입력할 수 있는 형식으로 변환하고 데이터가 올바른지 확인

  - [ ] 테스트 케이스 생성
  - [x] 데이터 불러오기
  - [x] 에러 처리
  - [x] Y/N 선택 로직 구현

- Books List Page

  전체 도서 목록을 출력한다. 겸사겸사 검색 도 구현한다.  
  도서를 선택하면 디테일 페이지로 넘어간다.

  - [x] 테스트 케이스 생성
  - [x] 전체 목록 출력
  - [x] id 검색 구현
  - [x] title 검색 구현

- Book Detail Page

  겸사겸사 도서에 상세 정보를 출력하고 대출이나 반납 기능을 사용할 수 있다. 또 대출 기록도 보게 하면 좋을 듯 하다. 이 페이지는 다음에도 사용할 것 같으니 선택 기준인 pk는 전역 변수로 선언해 줘야 할듯 하다.

  - [x] 테스트 케이스 생성
  - [x] 상세 정보 출력
  - [x] 대출 기능 구현
  - [x] 반납 기능 구현
  - [x] 대출 기록 출력

- Loan History Page

  대출 기록을 출력할 페이지 날짜의 역순으로 출력 할 예정이다.

  - [x] 테스트 케이스 생성
  - [x] 대출 정보 출력

- All Loan History Page

  모든 대출 기록을 출력

  - [x] 테스트 케이스 생성
  - [x] 대출 정보 출력


**database api**

데이터베이스 연결 부분 구현 코드가 적어 함수 단위로 작성하였다.

- [x] 테스트 케이스 생성
- [x] create tables
- [x] create book
- [x] read books
- [x] update book
- [x] create loan
- [x] read loans
- [x] update loan

## 2. 미션 진행 & 회고

---

### 2-1. 미션 진행 내용 요약

---

**CLI 계획**

우선 CLI 구현을 어떻게 할지 고민하였다. 요즘 추상화을 이해하고 있는 중이라 추상화를 적용해 보고 싶었다.

매번 화면이 지워지고 새로운 출력 결과가 생길텐데 그 하나의 화면을 page라는 단위로 추상화 하였다.

또 유저가 선택하는 경우와 입력하는 경우로 page를 나눠 추상화 하였다. 유저 입력이 없는 경우도 따로 뺄까 했지만 큰 의미가 없을 것 같았다. (추가될지도?)

ListPage를 구현할 때 각각의 선택지에 다른 로직을 어떻게 넣을지 고민이 있었다. 선택 리스트를 문자열로 받아 유저 입력을 처리하는 로직에서 입력 값으로 나눠 처리할 수도 있겠지만 그렇게 하면 코드의 중복이 늘어나고 유지보수가 어려울 것 같았다. 그래서 discordpy나 fastapi에서 사용하는 데코레이터를 참고하여 선택지를 생성하는 데코레이터를 만들어서 사용하려 하였으나 클래스 단위로 만들다 보니 잘 되지 않았다. 그래서 각각의 선택지를 ListOption 클래스를 상속받은 클래스에 답아서 구현하였다. 이렇게 하면 각각의 선택지에 다른 로직을 넣을 수 있고 유지보수도 쉬울 것 같았다.

CLI 디자인을 생각하다 보니 왼쪽에 목록 오른쪽에 상세를 보여주게 하고 싶었다.  
그래서 각각의 기능은 데이터만 전달하도록 구현하고 출력은 따로 화면을 그려줄 클래스를 만드는 게 좋을 것 같다. 그리고 화면을 직접 그리면 input을 쓰기는 어려울 듯 하니 메인 컨트롤러에서 입력을 기능에 넘겨주는 방식으로 구현해야 할 것 같다.

문제가 생겼다. 모든 입력을 keyboard module을 통해 입력받다 보니 한글 입력을 받을 수 없다는 문제가 생겼다. 우선 당장 입력을 받기엔 무리가 있어 보이기 때문에 영어만 입력할 수 있도록 하고 추후에 입력을 받는 방식을 바꿔야 할 것 같다.

UI 구상이 거의 끝나서 슬슬 DB api도 만들어야 할 것 같다. 아무래도 api 수가 적으니 클래스 없이 함수로 구현하면 편할 듯 하다. curser는 데코레이터로 가져올 계획이다. 디버깅을 어떻게 할지가 고민이다.  

음 도서 목록을 어떻게 할지 고민이 있었다. 굳이 id나 제목을 입력해 출력할 필요가 있을 까 싶어 일단 다 출력 하고 검색 조건을 받아 필터링 하는 방식으로 구현하였다. 처음에는 전체 목록 텝 따로 검색 텝 따로 두려 했지만 구현도 귀찮고 한번에 만들어도 크게 어렵지 않을 것 같아 전체 리스트 텝에서 검색을 받는 방식으로 구현하였다. 문제는 한글 입력이 안된다는 점이겠지

맘같아선 멘토님이 말씀해 주신대로 키 입력을 따로 받고 싶긴 한데 지금도 많이 복잡한데 멀티쓰레드까지 구현했다간 과제 취지에 맞지 않을 것 같아 나중에 심심하거나 리펙토링 때 도움좀 받아가며 구현해봐도 좋을 것 같다.

기능 구현을 끝냈다. 자잘한 버그가 있긴 한데 뭐 나중에 하면 되겠지 이제 help나 코드를 다듬어야겠다.



---

### 2-2. 회고

---

어찌저찌 구현을 완료하였다. 결과물은 기대보단 좋은 것 같지만 코드가 너무 더러운 것 같다. 페이지 실행 결과로 다음 페이지 이름을 받고 이를 통해 인스턴스를 만들다 보니 이전 페이지에서 다음 페이지로의 값 전달 부분이 조금 미숙하다고 느꼈다. 그래도 모든 인스턴스를 하나의 클래스에서 관리하는 장점은 느낄 수 있었다. 테스트 시 종속성 관리도 편하고 기능 추가도 어렵지 않았다. 페이지 객체를 만들 때 controller 인스턴스도 같이 넘겨주어 값을 전달하면 좀 더 깔끔한 코드가 될 거라 본다.

시간이 부족하기도 했고 데이터베이스에 대한 이해도 부족하여 쁘띠 ORM을 만들어 사용해 보려던 기존의 계획은 부류할 수 밖에 없었다. 덕분에 필요할 때 마다 쿼리를 짜서 함수를 만들다 보니 그냥 페이지 내에서 쿼리를 직접 호출하는 게 더 좋을 지경이였다. 좀 더 공부를 하고 이부분을 수정하면 좋을 것 같다. 그래도 쿼리를 짜는 것도 꽤 재미있었다. sql의 동작 원리를 모르다 보니 효율적인 쿼리를 짤 순 없었지만 필요한 내용을 추출할 정도는 되는 것 같다.

후반에 가서는 테스트 코드를 거의 짜나 마나 싶이 했다. 아무래도 page 클래스가 유저 입력을 처리하는 부분이다 보니 테스트에 어려움이 있었다. 또 테스트 시에 main db를 건들일 수도 없는 노릇이라 고민을 해야 했었다. 항상 TDD를 생각하고 있긴 하지만 테스트케이스를 짜기가 참 어려운 것 같다.

파이썬에서 한글의 길이를 1로 처리하는 바람에 화면을 그리는 데 고생을 했다. 처음에는 영어인지 확인하여 길이를 만들어 반환하는 함수를 직접 만들었지만 특수문자를 처리하는 데 어려움이 있었다. 그래서 문자를 유니코드로 인코딩 하여 길이를 구하였는데 구글링 해보니 어느 분이 한글 문자열을 길이 맞춰 정렬하는 코드를 올려둬서 복붙해왔다. 역시 구글링이 짱이다.

언젠가 NVIM을 한참 사용해 보려던 때가 있었는 데 그때 NVIM의 인터페이스가 참 신세계였다. 터미널 환경에서 어떻게 그정도의 기능을 넣었는지 정말 놀라웠다. 그래서 NVIM의 인터페이스를 꿈꾸며 이렇게 만들었는데 생각보다 어려웠다. keyboard 모듈이 이벤트를 받고 처리는 해주지 않아 프로그램이 끝난 후 터미널에 이펜트가 한번에 작성되는 문제도 있고 한글자 한글자 영어로 입력받아 페이지에서 처리하다 보니 한글 입력에 어려움이 있었다. 그래도 pygame 찍먹 할 때의 경험을 살려 나름대로 잘 만들어진 것 같다. 리펙토링 시에는 한번 한글 입력도 도전해 봐야 겠다.

table을 좀 이쁘게 출력하고 싶은데 문제가 많다. table이 세로로 긴 건 이미 구현을 해놨지만 가로로 갈면 어떻게 구현할지 정말 막막하다. 그래서 일단 대충 출력해 놨는데 진짜 너무 불편하다. 리펙토링 때 저거부터 어떻게 해야 겠다. 계획은 있다. 'l', 'h'키로 좌우로 이동할 수 있도록 하고 테이블의 왼쪽 부분을 잘라서 구현할 계획이긴 하다. 다만 page에서 터미널의 가로 길이를 알 수 없으니 전역변수로 선언해 줘야겠지만 맘에 안든다. 그래도 일단 고민을 해봐야 겠다.

결론적으로 오랜만에 코딩 과제 하려니 재미있었다. 미리 끝내놓고 다른사람들 참견하고 다니고 싶었는데 일때문에 구현이 늦어서 아쉬울 따름이다. 리펙토링 때 다른 분들 코드나 구경해야지

---

## 3. 실행 요령

`setting.py`에서 DB 정보를 수정해 줍니다.

### 3.1. Windows

```bat
python -V 
rem 3.10.6

python -m venv venv
venv\Scripts\activate.bat
pip install -r requirements.txt
python main.py
```

---

### 3.2 Linux

```bash
python -V
# 3.10.6

python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
python main.py
```

---